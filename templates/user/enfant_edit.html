{% extends "base.html" %}
{% block title %}Modifier un enfant{% endblock %}

{% block content %}
<h1 class="mb-4">Modifier l'enfant</h1>

<form method="post" class="card p-4 shadow-sm">
  {% csrf_token %}
 <div class="mb-3">
    {{ form.prenom.label_tag }}
    {{ form.prenom }}
    {% if form.prenom.errors %}
      <div class="text-danger">{{ form.prenom.errors }}</div>
    {% endif %}
  </div>
  
  <div class="mb-3">
    {{ form.nom.label_tag }}
    {{ form.nom }}
    {% if form.nom.errors %}
      <div class="text-danger">{{ form.nom.errors }}</div>
    {% endif %}
  </div>
  
  <div class="mb-3">
    {{ form.tuteur.label_tag }}
    {{ form.tuteur }}
    <datalist id="tuteur-options">
      <option value="Parents"></option>
      <option value="Père"></option>
      <option value="Mère"></option>
      <option value="Grand-parents"></option>
      <option value="Oncle/Tante"></option>
      <option value="Autre famille"></option>
      <option value="Tuteur légal"></option>
      <option value="Autre"></option>
    </datalist>
  </div>
  
  <div class="mb-3">
    {{ form.etablissement.label_tag }}
    {{ form.etablissement }}
    {% if form.etablissement.errors %}
      <div class="text-danger">{{ form.etablissement.errors }}</div>
    {% endif %}
  </div>



    {{ adresse_form.as_p }}
 
  <div class="d-flex gap-2">
    <button type="button" class="btn btn-outline-secondary" onclick="geocoderAdresse()">Trouver coordonnées</button>
    <button type="submit" class="btn btn-primary">Modifier</button>
  </div>

  <div class="text-end">
    <button type="button" class="btn btn-light" onclick="history.back()">← Retour</button>
  </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
function geocoderAdresse() {
  const rue = document.getElementById("id_num_et_rue")?.value;
  const ville = document.getElementById("id_ville")?.value;
  const code = document.getElementById("id_code_postal")?.value;
  if (!rue || !ville || !code) { alert("Merci de remplir adresse, ville et code postal."); return; }
  const adresse = encodeURIComponent(`${rue}, ${code} ${ville}, France`);
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${adresse}`)
    .then(r => r.json())
    .then(data => {
      if (data?.length) {
        document.getElementById("id_latitude").value = data[0].lat;
        document.getElementById("id_longitude").value = data[0].lon;
      } else { alert("Coordonnées non trouvées."); }
    })
    .catch(() => alert("Erreur lors de la recherche."));
}
</script>
{% endblock %}
